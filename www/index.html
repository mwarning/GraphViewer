<!DOCTYPE html>

<html>
<head>
	<meta charset="utf-8">
	<title>MeshNet Simulator</title>
	<link rel="stylesheet" type="text/css" href="style.css">

	<!-- Source: http://d3js.org -->
	<script src="js/d3.v5.min.js"></script>

	<script src="js/utils.js"></script>
	<script src="js/graph.js"></script>
	<script src="js/draw.js"></script>
	<script src="js/show.js"></script>
	<script src="js/control.js"></script>

	<script>
		var graph;
		var show;
		var control;

		function handle_graph(data) {
			var json = {};
			try {
				json = JSON.parse(data);
			} catch (e) {
				console.log(e);
			}

			if (json.nodes && json.links) {
				graph.updateGraph(json.nodes, json.links);
			}
		}

		function run_update_loop() {
			var interval_ms = 250;

			function looped_request_graph() {
				send("/cmd/graph", {}, function(data) {
					handle_graph(data);
					setTimeout(looped_request_graph, interval_ms);
				});
			}

			looped_request_graph();
		}

		function request_graph() {
			send("/cmd/graph", {}, function(data) {
				handle_graph(data);
			});
		}

		function init() {
			// Select first tab
			document.getElementsByClassName('tablinks')[0].click();

			graph = createGraph('graph');
			show = createShow(graph);
			control = createControl(graph);

			run_update_loop();
		}
	</script>
</head>
<body onload="init()">
	<div id="container">
		<div id="toolbar">
			<div class="tab">
				<button class="tablinks" onclick="showTab(event, 'edit')">Edit</button>
				<button class="tablinks" onclick="showTab(event, 'show')">Show</button>
				<button class="tablinks" onclick="showTab(event, 'control')">Control</button>
			</div>
			<div id="edit" class="tabcontent">
				<fieldset>
					<legend>Selection</legend>
					<div class="equal">
						<input type="button" onclick="graph.extendSelection()" value="extend" />
						<input type="button" onclick="graph.clearSelection()" value="unselect" />
					</div>
				</fieldset>
				<fieldset>
					<legend>Modify</legend>
					<div class="equal">
						<input type="button" onclick="graph.connectSelectedNodes()" value="connect" />
						<input type="button" onclick="graph.disconnectSelectedNodes()" value="disconnect" />
						<input type="button" onclick="graph.removeSelectedItems()" value="remove" />
					</div>
				</fieldset>
				<fieldset>
					<legend>Animation</legend>
					<div class="equal">
						<input type="button" onclick="graph.toggleAnimation()" value="toggle" />
					</div>
				</fieldset>
			</div>

			<div id="control" class="tabcontent">
				<fieldset>
					<legend title="Send a string to each selected node">Send Command</legend>
					<div class="enum">
						<input type="text" value="" id="command_request" />
						<input type="button" value="send" onclick="control.sendCommand(getText('command_request'))" />
					</div>
					<div class="equal">
						<textarea id="command_reply" rows="40" cols="55"></textarea>
					</div>
				</fieldset>
			</div>

			<div id="show" class="tabcontent">
				<fieldset>
					<legend>Inspect</legend>
					<div class="enum">
						<label>Type:</label>
						<span id="show_type">-</span>
					</div>
					<div class="enum">
						<label>Path:</label>
						<span id="show_path">/</span>
					</div>
					<div class="equal">
						<input type="button" onclick="show.showSelectedObject()" value="Show" />
					</div>
					<div class="equal">
						<table>
							<thead>
								<tr>
									<th onclick="sortLexial(this)">Key</th>
									<th onclick="sortLexial(this)">Value</th>
								</tr>
							</thead>
							<tbody id="show_object_tbody">
							</tbody>
							<tr id="show_no_items">
								<td colspan="2">No Items</td>
							</tr>
						</table>
					</div>
				</fieldset>
			</div>
		</div>
		<div id="graph" class="graph">
		</div>
	</div>
	<noscript>
		<strong>JavaScript required</strong>
	</noscript>
</body>
</html>
