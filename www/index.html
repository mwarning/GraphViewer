<!DOCTYPE html>

<html>
<head>
	<meta charset="utf-8">
	<title>MeshNet Simulator</title>
	<link rel="stylesheet" type="text/css" href="style.css">

	<!-- Source: http://d3js.org -->
	<script src="js/d3.v5.min.js"></script>

	<script src="js/utils.js"></script>
	<script src="js/graph.js"></script>
	<script src="js/draw.js"></script>
	<script src="js/edit.js"></script>
	<script src="js/show.js"></script>
	<script src="js/control.js"></script>

	<script>
		var graph;
		var edit;
		var show;
		var control;

		function globalUpdateGraph() {
			send('/cmd/graph', {}, function(data) {
				var json = JSON.parse(data);
				graph.updateGraph(json.nodes, json.links);
			});
		}

		// rename to updateData
		function globalUpdateNodes() {
			send('/cmd/nodes', {}, function(data) {
				var json = JSON.parse(data);
				graph.updateData(json.nodes);
			});
		}

		function globalUpdate() {
			globalUpdateGraph();
			globalUpdateNodes();
		}

		function init() {
			// Select first tab
			document.getElementsByClassName('tablinks')[0].click();

			graph = createGraph('graph');
			edit = createEdit(graph);
			show = createShow(graph);
			control = createControl(graph);

			//poller();
			//globalUpdate();
			graph.updateGraph(
				[{mac: 1}, {mac: 2}],
				[{source: 1, target: 2, source_tq: 1, target_tq: 1}]
			);
		}
	</script>
</head>
<body onload="init()">
	<div id="container">
		<div id="toolbar">
			<div class="tab">
				<button class="tablinks" onclick="showTab(event, 'edit')">Edit</button>
				<button class="tablinks" onclick="showTab(event, 'show')">Show</button>
				<button class="tablinks" onclick="showTab(event, 'control')">Control</button>
			</div>
			<div id="edit" class="tabcontent">
				<fieldset>
					<legend>Select</legend>
					<div class="equal">
						<input type="button" onclick="graph.extendSelection()" value="extend" />
						<input type="button" onclick="graph.clearSelection()" value="unselect" />
						<input type="button" onclick="graph.removeSelection()" value="remove" />
					</div>
				</fieldset>
				<fieldset>
					<legend>Modify</legend>
					<div class="equal">
						<input type="button" onclick="graph.connectSelectedNodes()" value="connect" />
						<input type="button" onclick="graph.disconnectSelectedNodes()" value="disconnect" />
					</div>
				</fieldset>
				<fieldset>
					<legend>Misc</legend>
					<div class="enum">
						<div>
							<input type="button" onclick="edit.connectInRange(getInt('connect_range'))" value="connectInRange" />
						</div>
						<div class="equal">
							<input type="number" id="connect_range" min="1" max="999" value="3" />
						</div>
					</div>
					<div class="enum">
						<div>
							<input type="button" onclick="edit.randomizePositions(getInt('positions_range'))" value="randomizePositions" />
						</div>
						<div class="equal">
							<input type="number" id="positions_range" min="1" max="999" value="3" />
						</div>
					</div>
				</fieldset>
				<fieldset>
					<legend>Add Primitives</legend>
					<div class="enum">
						<div>
							<input type="button" onclick="edit.addNodes(1)" value="Node" />
						</div>
					</div>
					<div class="enum">
						<div>
							<input type="button" onclick="edit.addLine(getInt('line_n'), getBool('line_close'))" value="Line" />
						</div>
						<div class="equal">
							<input type="number" id="line_n" min="1" max="999" value="3" />
							<input type="checkbox" id="line_close" />
							<span>Loop</span>
						</div>
					</div>
					<div class="enum">
						<div>
							<input type="button" onclick="edit.addStar(getInt('star_n'))" value="Star" />
						</div>
						<div class="equal">
							<input type="number" id="star_n" min="1" max="999" value="4" />
						</div>
					</div>
					<div class="enum">
						<div>
							<input type="button" onclick="edit.addLattice4(getInt('lattice4_x'), getInt('lattice4_y'))" value="4-Lattice" />
						</div>
						<div class="equal">
							<input type="number" id="lattice4_x" min="1" max="999" value="3" />
							<span>x</span>
							<input type="number" id="lattice4_y" min="1" max="999" value="3" />
						</div>
					</div>
					<div class="enum">
						<div>
							<input type="button" onclick="edit.addLattice8(getInt('lattice8_x'), getInt('lattice8_y'))" value="8-Lattice" />
						</div>
						<div class="equal">
							<input type="number" id="lattice8_x" min="1" max="999" value="3" />
							<span>x</span>
							<input type="number" id="lattice8_y" min="1" max="999" value="3" />
						</div>
					</div>
					<div class="enum">
						<div>
							<input type="button" onclick="edit.addTree(getInt('tree_c'), getInt('tree_d'))" value="Tree" />
						</div>
						<div class="equal">
							<input type="number" id="tree_c" min="1" max="999" value="8" />
							<label title="Add additional random connections to the tree.">Extra:</label>
							<input type="number" id="tree_d" min="0" max="999" value="0" />
						</div>
					</div>
				</fieldset>
				<fieldset>
					<legend>Link Parameters</legend>
					<div class="enum">
						<label>Quality:</label>
						<input type="number" id="quality_value" min="0" max="100" value="50" />
						<span>%</span>
						<select id="quality_generation">
							<option value="fixed">Fixed</option>
							<option value="random">Random</option>
						</select>
					</div>
					<div class="enum">
						<div>
							<label>Bandwidth:</label>
						</div>
						<div>
							<input type="number" id="bandwidth_value" min="0" max="100" value="50" />
						</div>
					</div>
					<div class="enum">
						<div>
							<label>Channel:</label>
						</div>
						<div>
							<input type="number" id="channel_value" min="0" max="100" value="0" />
						</div>
					</div>
					<div class="equal">
						<input type="button" onclick="edit.getLinkParameters('bandwidth_value', 'quality_value', 'channel_value')" value="Get" />
						<input type="button" onclick="edit.setLinkParameters('bandwidth_value', 'quality_value', 'quality_generation', 'channel_value')" value="Set" />
					</div>
				</fieldset>
				<fieldset>
					<legend>Animation</legend>
					<div class="equal">
						<input type="button" onclick="graph.toggleAnimation()" value="toggle" />
					</div>
				</fieldset>
				<fieldset>
					<legend>Miscellaneous</legend>
					<div class="equal">
						<input type="button" onclick="edit.removeUnconnected()" value="remove single" />
						<input type="button" onclick="graph.resetView()" value="reset view" />
						<input type="button" onclick="graph.removeGraph()" value="remove graph" />
					</div>
				</fieldset>
				<fieldset>
					<legend>Graph Statistics</legend>
					<div class="enum">
						<label>Links:</label>
						<span id="graph_links_count">0</span>
					</div>
					<div class="enum">
						<label>Nodes:</label>
						<span id="graph_nodes_count">0</span>
					</div>
				</fieldset>
			</div>

			<div id="control" class="tabcontent">
				<fieldset>
					<legend title="Send a string to each selected node">Send Command</legend>
					<div class="enum">
						<input type="text" value="" id="command_request" />
						<input type="button" value="send" onclick="control.sendCommand(getText('command_request'))" />
					</div>
					<div class="equal">
						<textarea id="command_reply" rows="40" cols="55"></textarea>
					</div>
				</fieldset>
			</div>

			<div id="show" class="tabcontent">
				<fieldset>
					<legend>Inspect</legend>
					<div class="enum">
						<label>Type:</label>
						<span id="show_type">-</span>
					</div>
					<div class="enum">
						<label>Path:</label>
						<span id="show_path">/</span>
					</div>
					<div class="equal">
						<input type="button" onclick="show.showSelectedObject()" value="Show" />
					</div>
					<div class="equal">
						<table>
							<thead>
								<tr>
									<th onclick="sortLexial(this)">Key</th>
									<th onclick="sortLexial(this)">Value</th>
								</tr>
							</thead>
							<tbody id="show_object_tbody">
							</tbody>
							<tr id="show_no_items">
								<td colspan="2">No Items</td>
							</tr>
						</table>
					</div>
				</fieldset>
			</div>
		</div>
		<div id="graph" class="graph">
		</div>
	</div>
	<noscript>
		<strong>JavaScript required</strong>
	</noscript>
</body>
</html>
